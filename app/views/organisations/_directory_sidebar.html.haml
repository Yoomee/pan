-content_for :head do
  :javascript
    $(document).ready(function() {
      Directory.init();
      });

-original_tags = @tags || []


#directory-sidebar
  -if @type.present? || @collection.present? || @query.present? || @tags.present? || @region.present?
    .well
      %h4 Filters
      -if @type.present? || @collection.present? 
        %ul.unstyled
          =type_filter_link(@type)
          =collection_filter_link(Collection.all.detect { |c| c.name.parameterize == @collection }) if @collection.present?
      .show-tags
        -@tags.sort.each do |tag|
          -param_tags = original_tags.dup
          =directory_item_tag(Tag.find_by_name(tag), param_tags)
      .clearfix
      -if @region.present?
        %ul.unstyled
          =region_filter_link(:li, Pan::REGIONS.detect { |r| r[0] ==@region })
      =link_to 'view all', directory_path, :class => 'pull-right'
      .clearfix
  .well
    %h4 Search
    =form_tag(directory_path, :method => :get, :id => 'directory-search') do
      =text_field_tag(:q, @query)
      .hide
        =select_tag(:type, options_from_collection_for_select(%w{Performer Promoter Tour Venue User}, :to_s, :to_s, params[:type]), :prompt => 'Please select...')
        =select_tag(:collection, options_from_collection_for_select(Collection.order(:name), :id, :name, params[:collection]), :prompt => 'Please select...')
        =select_tag(:region, options_from_collection_for_select(Pan::REGIONS.sort, :first, :last, params[:region]), :prompt => 'Please select...')
        -Tag.genres.each do |tag|
          =check_box_tag('tags[]', tag.name.parameterize, @tags.include?(tag.name.parameterize), :class => 'tags', :id => "tag-#{tag.name.parameterize}")
      =submit_tag('Filter', :class => 'btn')
  .well
    %h4 Type
    %ul.unstyled
      -%w{Performer Promoter Tour Venue User}.each do |type|
        =type_filter_link(type)
  .well
    %h4 Collections
    %ul.unstyled
      -Collection.order(:name).each do |collection|
        =collection_filter_link(collection)
  .well
    %h4 Genre
    .show-tags
      =render 'organisations/tags_for_directory_view', :tags => Tag.genres, :original_tags => original_tags
    .clearfix
  .well
    %h4 Locations
    %ul.unstyled
      -Pan::REGIONS.sort.each do |region|
        =region_filter_link(:li, region)

