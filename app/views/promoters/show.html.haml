-if !promoter.venues.with_lat_lng.empty?
  =google_maps_javascript_include_tag
  =content_for :head do
    :javascript
      $(document).ready(function() {
        VenuesMap.venues = #{promoter.venues.with_lat_lng.to_json(:only => [:id, :name, :lat, :lng], :methods => [:infowindow_image_url, :short_description])};
        VenuesMap.init();
      });

.row
  .span3
    .row.profile-left-col
      .span3
        =image_for(promoter, "220x") if promoter.image
      -if !promoter.venues.with_lat_lng.empty?
        .span3.mt-2
          #map_canvas{:style => "height:220px;width:100%"}
      .span3.mt-2
        %h4 Region
        %p=promoter.region
      -if promoter.any_present?(:address, :phone, :email)
        .span3.mt-2
          %h4 Contact
          %ul.unstyled
            -if promoter.address.present?
              %li
                =promoter
                =render_address(promoter)
            -if promoter.phone.present?
              %li
                Tel:
                =internationalize_phone_number(promoter.phone)
            -if promoter.email.present?
              %li
                Email:
                =link_to promoter.email, "mailto:#{promoter.email}"
      -if promoter.any_present?(:website_url, :facebook_url, :twitter_url)
        .span3.mt-2
          %h4 Links
          %ul.unstyled
            -if promoter.website_url.present?
              %li=link_to(truncate(promoter.website_url, :length => 32), promoter.website_url, :target => "_blank")
            -if promoter.facebook_url.present?
              %li=link_to("Facebook", promoter.facebook_url)
            -if promoter.twitter_url.present?
              %li=link_to("Twitter", promoter.twitter_url, :target => '_blank')
    
  .span9
    %h1.mb-1=title(promoter)
    =simple_format(promoter.description)
    .row.mt-2
      .span9
        %h4.mb-1 Venues
        -if promoter.venues.empty?
          =promoter
          doesn't have any venues yet.
          =link_if_can "Add one", [:new, promoter, :venue]
        -else
          %ul.unstyled
            -promoter.venues.each do |venue|
              %li
                =venue
                =link_to 'View', venue            
    .row.mt-2
      .span9
        %h4 Individual profiles
          
        .row.mt-1
          -if promoter.users.empty?
            .span8
              =promoter
              doesn't have any individuals yet.
              =link_if_can "Add one", [:new, promoter, :user]
          -else
            -promoter.users.each do |user|
              .span2
                =link_to image_for(user,"120x120#"), user
                %h5=link_to_self user
                %p=user.job_title
    .row.mt-2
      .span9
        .row
          .span4
            %h4.mb-1 Genres/art-forms currently promoting
            %ul.unstyled
              %li Alternative
          -if (tag_list = (promoter.art_form_list + promoter.genre_list).uniq).present?
            .span4
              %h4.mb-1 Genres/art-forms interested in
              %ul.unstyled
                -tag_list.each do |tag_name|
                  %li=tag_name.titleize.humanize
    .row.mt-2
      .span9
        %h4 List of resources
    .row.mt-2
      .span9
        %h4 Skills matrix
    -if (media_posts = promoter.posts.where("image_uid LIKE '%'").limit(8)).present?
      .row.mt-2
        .span9
          %h4 Photos/videos
          .row.mt-1
            -media_posts.each do |media_post|
              .span1.mb-1
                =link_to("#", :data => {:toggle => "modal", :backdrop => false, :"modal-url" => modal_post_path(media_post), :"modal-id" => "post_modal"}) do
                  =image_for(media_post, '60x60#', :class => "#{media_post.has_video? ? 'video-image' : ''}")
    -if posts.present? || can?(:create, Post)
      .row.mt-2
        .span9
          %h4.mb-1 Updates
          -if can?(:create, Post)
            =render("posts/remote_form", :post => current_user.posts.build(:target => promoter))
          =render("posts/posts", :posts => posts)
.row.mt-2
  .span9
    =options_panel do
      =back_link
      =link_if_can("Edit promoter", [:edit, promoter])
      =link_if_can("Delete promoter", [:destroy, promoter], :confirm => "Are you sure?")
      =link_if_can("Add venue", [:new, promoter, :venue])
      =link_if_can("Add individual", [:new, promoter, :user])
