.row
  .span3
    .row.profile-left-col
      .span3
        =image_for(tour, "220x")
      .span3.mt-2
        %h4=pluralize(tour.reviews.count, 'Review')
        %div=rating_stars(tour.overall_rating)
        %ul.unstyled
          %li=link_to 'Read reviews', tour_reviews_path(tour) unless tour.reviews.count.zero?
          %li=link_to 'Write a review', new_tour_review_path(tour)
      -if tour.links_or_performer_links.present?
        .span3.mt-2
          %h4 Links
          %ul.unstyled.links
            -tour.links_or_performer_links.each do |link|
              %li
                =image_tag(link.favicon)
                =link_to(link, link.url, :target => '_blank')
      -if tour.contact1_details.present?
        .span3.mt-2
          %h4 Primary contact
          =auto_link(tour.contact1_details.join("<br />").html_safe)
      -if tour.contact2_details.present?
        .span3.mt-2
          %h4 Secondary contact
          =auto_link(tour.contact2_details.join("<br />").html_safe)
      
          
      -future_tour = tour.performer.tours.order(:end_on).where("end_on > :now", now: Time.now)
      -if logged_in_as_performer?(performer) || future_tour.present?
        .span3.mt-2
          %h4
            ="Upcoming #{future_tour.count > 1 ? "tours" : "tour"}"
          -if future_tour.nil?
            .italic
              =link_to("Click here", new_performer_tour_path(tour.performer))
              to enter information about your next tour.
          -elsif future_tour.empty?
            .italic
              =link_to("Click here", performer_tours_path(tour.performer, :anchor => 'all'))
              to manage all your tours and dates.
          -else
            %ul.unstyled
              -future_tour.each do |tour|
                %li
                  =link_to(tour.name_with_dates, tour)
      -if !tour.performer.tours.past.empty?
        .span3.mt-2
          %h4 Past tours
          =link_to("View all past shows", performer_tours_path(tour.performer, :anchor => 'past'))
      
      
      
        
  .span6
    %h1
      =title(tour)
      %small=link_to_self(tour.performer)
    %h3.mb-1=tour.dates_string
    =simple_format(tour.description)
  .span3
    .well
      -if current_user.promoter
        =render("helpboxes/tour_promoter")
      -elsif logged_in_as_site_admin?
        =render("helpboxes/tour_site_admin")
      -elsif logged_in_as_performer?(performer)
        =render("helpboxes/performer_tour_admin")
  .span9
    -if tour.genre_list.present?
      .row.mt-2
        .span5.mb-1
          %h4 Genres
          =list_tags(tour, :genres)
    .row.mt-2
      .span5
        %h4 Technical requirements
        %table
          -if tour.min_playing_area.present?
            %tr
              %td.span3 Minimum playing area required
              %td.span2="#{tour.min_playing_area} sq m"
          -tour.technical_details.each do |detail, true_false|
            %tr
              %td.span3=detail
              %td.span2=true_false.yes_or_no.capitalize
      .span4
        %h4 Venue suitability
        %table
          -tour.venue_suitability.each do |venue_type, true_false|
            %tr
              %td.span3=venue_type
              %td.span1=true_false.yes_or_no.capitalize
    .row.mt-2
      -if tour.requirements.present?
        .span9
          %h4 Other requirements
          =simple_format(tour.requirements)
      -if tour.target_age.present?
        .span9
          %h4 Target age range/style
          =simple_format(tour.target_age)
      -if tour.running_time.present?
        .span9
          %h4 Running time/with and without interval
          =simple_format(tour.running_time)
      -if tour.publicity.present?
        .span9
          %h4 Will publicity be provided?
          =simple_format(tour.publicity)
      -if tour.fees.present?
        .span9
          %h4 Fees
          =simple_format(tour.fees)
    .row
      .span9
        #calendar
          %h3 Book a date
          =render("tours/calendar_key", :hide_unavailable => true)
          =render("calendar_form", :tour => tour, :bookings_page => false, :remote => true)
            
.row.mt-2
  .span9
    =options_panel do
      =back_link
      =link_to("Edit tour", edit_tour_path(tour)) if can?(:edit,tour)
      =link_if_can("Delete tour", [:destroy, tour], :confirm => "Are you sure?")
      =link_to("Manage bookings", bookings_tour_path(tour)) if can?(:bookings, tour)
