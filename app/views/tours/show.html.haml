.row
  .span3
    .row.profile-left-col
      .span3
        =image_for(tour, "220x")
      .span3.mt-2
        %h4=pluralize(tour.reviews.count, 'Review')
        %div=rating_stars(tour.overall_rating)
        %ul.unstyled
          %li=link_to 'Read reviews', tour_reviews_path(tour) unless tour.reviews.count.zero?
          %li=link_to 'Write a review', new_tour_review_path(tour)
      -if tour.links_or_performer_links.present?
        .span3.mt-2
          %h4 Links
          %ul.unstyled.links
            -tour.links_or_performer_links.each do |link|
              %li
                =image_tag(link.favicon)
                =link_to(link, link.url, :target => '_blank')
      -if tour.contact1_details.present?
        .span3.mt-2
          %h4 Primary contact
          =auto_link(tour.contact1_details.join("<br />").html_safe)
      -if tour.contact2_details.present?
        .span3.mt-2
          %h4 Secondary contact
          =auto_link(tour.contact2_details.join("<br />").html_safe)
      
          
      -future_tour = tour.performer.tours.order(:end_on).where("end_on > :now", now: Time.now)
      -if logged_in_as_performer?(performer) || future_tour.present?
        .span3.mt-2
          %h4
            ="Upcoming #{future_tour.count > 1 ? "tours" : "tour"}"
          -if future_tour.nil?
            .italic
              =link_to("Click here", new_performer_tour_path(tour.performer))
              to enter information about your next tour.
          -elsif future_tour.empty?
            .italic
              =link_to("Click here", performer_tours_path(tour.performer, :anchor => 'all'))
              to manage all your tours and dates.
          -else
            %ul.unstyled
              -future_tour.each do |tour|
                %li
                  =link_to(tour.name_with_dates, tour)
      -if !tour.performer.tours.past.empty?
        .span3.mt-2
          %h4 Past tours
          =link_to("View all past shows", performer_tours_path(tour.performer, :anchor => 'past'))      
  .span6
    %h1
      =title(tour)
      %small=link_to_self(tour.performer)
    %h3.mb-1=tour.dates_string
    =simple_format(tour.description)
  .span3
    .well
      -if current_user.promoter
        =render("helpboxes/tour_promoter")
      -elsif logged_in_as_site_admin?
        =render("helpboxes/tour_site_admin")
      -elsif logged_in_as_performer?(performer)
        =render("helpboxes/performer_tour_admin")
  .span9
    -if tour.genre_list.present?
      .row.mt-2
        .span5.mb-1
          %h4 Genres
          =list_tags(tour, :genres)
          
          
          
          
    .row.mt-2
      .span4
        %table.table.table-bordered.table-striped.tech-details.mb-2.mt-1
          %thead
            %tr
              %th
                %h3
                  Technical requirements
          %tbody
            -if tour.min_playing_area.present?
              %tr
                %td
                  Minimum playing area required
                %td
                  =description_tag("","#{tour.min_playing_area} sq m")
            %tr
              %td
                Do you need a blackout?
              %td
                =description_tag("", tour.blackout_needed?.yes_or_no.titleize)
            %tr
              %td
                Do you use lighting?
              %td
                =description_tag("", tour.uses_lighting?.yes_or_no.titleize)
            %tr
              %td
                Do you tour your own lighting?
              %td
                =description_tag("", tour.uses_own_lighting?.yes_or_no.titleize)
            %tr
              %td
                Do you use sound?
              %td
                =description_tag("", tour.uses_sound?.yes_or_no.titleize)          


      .span4.offset1
        %table.table.table-bordered.table-striped.tech-details.mb-2.mt-1
          %thead
            %tr
              %th
                %h3
                  Venue suitability
          %tbody
            %tr
              %td
                Arts venue
              %td
                =description_tag("", tour.suits_arts_venue?.yes_or_no.titleize)
            %tr
              %td
                Village/community hall
              %td
                =description_tag("", tour.suits_village_hall?.yes_or_no.titleize)
            %tr
              %td
                School hall
              %td
                =description_tag("", tour.suits_school_hall?.yes_or_no.titleize)
            %tr
              %td
                Outdoors
              %td
                =description_tag("", tour.suits_outdoors?.yes_or_no.titleize)
             
    
    -if tour.requirements.present? || tour.target_age.present? || tour.running_time.present? || our.publicity.present? || tour.fees.present?
      .row
        .span9
          %table.table.table-bordered.table-striped.tech-details.mb-2
            %thead
              %tr
                %th
                  %h3
                    Other
            %tbody
              -if tour.requirements.present?
                %tr
                  %td
                    Other requirements
                  %td
                    =simple_format(tour.requirements)
              -if tour.target_age.present?
                %tr
                  %td
                    Target age range/style
                  %td
                    =simple_format(tour.target_age)
              -if tour.running_time.present?
                %tr
                  %td
                    Running time/with and without interval
                  %td
                    =simple_format(tour.running_time)
              -if tour.publicity.present?
                %tr
                  %td
                    Will publicity be provided?
                  %td
                    =simple_format(tour.publicity)
              -if tour.fees.present?
                %tr
                  %td
                    Fees
                  %td
                    =simple_format(tour.fees)
                
    .row
      .span9
        #calendar
          %h3 Book a date
          =render("tours/calendar_key", :hide_unavailable => true)
          =render("calendar_form", :tour => tour, :bookings_page => false, :remote => true)
            
.row.mt-2
  .span9
    =options_panel do
      =back_link
      =link_to("Edit tour", edit_tour_path(tour)) if can?(:edit,tour)
      =link_if_can("Delete tour", [:destroy, tour], :confirm => "Are you sure?")
      =link_to("Manage bookings", bookings_tour_path(tour)) if can?(:bookings, tour)
