-content_for :head do
  :javascript
    $(document).ready(function() {
      var base_url = "diary?#{{:tags => @tags.uniq, :month => @month, :year => @year}.to_query}"
      $('#start_date').change(function() {
        location.href = base_url + '&start_date=' + encodeURIComponent($(this).val()) + '&end_date=' + encodeURIComponent($('#end_date').val());
      });
      $('#end_date').change(function() {
        location.href = base_url + '&start_date=' + encodeURIComponent($('#start_date').val()) + '&end_date=' + encodeURIComponent($(this).val());
      });
      $('#remove-start-date').click(function() {
        location.href = base_url + '&start_date=&end_date=' + encodeURIComponent($('#end_date').val());
      });
      $('#remove-end-date').click(function() {
        location.href = base_url + '&start_date=' + encodeURIComponent($('#start_date').val()) + '&end_date=';
      });
    });

-original_tags = @tags || []

.row
  .span9
    %h1.mb-2.mt-2 Diary

.row
  .span9
    .well
      %table#diary
        %thead
          %tr
            %th.span1=link_to_previous_month(@month, @year, @tags, @start_date, @end_date)
            %th.month.span7{:colspan => 2}
              =Date::MONTHNAMES[@month.to_i]
              =@year
            %th.span1=link_to_next_month(@month, @year, @tags, @start_date, @end_date)

        %tbody
          -if @dates.size == 0
            %tr
              %td{:colspan => 4}
                %p.lead No diary dates with these filters!
          -else
            -@dates.each do |date|
              %tr
                %td.date=date.date.to_s(:day_and_date)
                %td
                  =link_to_self date.tour, :class => "tour"
                %td
                  -if date.venue_id > 0
                    =link_to_self date.venue, :class => "venue"
                  -else
                    .venue=date.external_venue_name
                %td
                  .clearfix
                  .show-tags
                    -date.tour.genres.each do |tag|
                      -param_tags = original_tags.dup
                      -param_tags << tag.name unless param_tags.delete(tag.name)

                      =tag_link(tag.name, {:tags => param_tags, :start_date => @start_date,:end_date => @end_date, :month => @month, :year => @year }, "tag #{@tags.include?(tag.name.gsub(/-/, ' ')) ? 'active' : ''}")
                  .clearfix

  .span3
    =render 'shows/filter_sidebar', :original_tags => original_tags, :month => @month, :year => @year